<% content_for :head do %>
<%= stylesheet_link_tag    :karnevalister, :media => :all %>
<% end %>

<div class="header">
  <div class="container">
    <h1>Uppdelning av karnevalister</h1>
  </div>
</div>

<div class="container" id="uppdelning_search">
  <%= render 'search_filter_form' %>
</div>

<% if !@karnevalister.blank? %>
<table class="table table-condensed">
  <thead>
    <tr>
      <th>Namn</th>
      <th>Personnummer</th>
      <th>Tilldelad sektion</th>
      <th>Stjärnmarkerad sektion</th>
      <th>Stjärnmarkerad funktion</th>
      <th>Klar?</th>
    </tr>
  </thead>
  <tbody>
    <% @karnevalister.each do |k| %>
      <tr>
        <td><%= link_to_modal "#{k.efternamn}, #{k.fornamn}", controller: "karnevalister", action: "show_modal", id: k %></td>
        <td><%= k.personnummer %></td>
        <td>
            <% if k.tilldelad_sektion.blank? %>
              <!-- Ajax code -->
              <%= form_tag '/karnevalister/search_filter', :method => :get do %>
                <%= select_tag :tilldelad_sektion_id, options_from_collection_for_select(Sektion.all, :id, :name), {:prompt => "-- Välj sektion --"} %>
              <% end %>
            <% else %>
                <%= Sektion.find(k.tilldelad_sektion).name %>
            <% end %>
        </td>
        <td>
            <% if !k.snalla_sektion.blank? %>
                <%= Sektion.find(k.snalla_sektion).name %>
            <% end %>
        </td>
        <td>
            <% if !k.snalla_intresse.blank? %>
                <%= Intresse.find(k.snalla_intresse).name %>
            <% end %>
        </td>
        <td>
            <% if !k.tilldelad_sektion.blank? %>
              <% if k.tilldelad_klar %>
                <img src="/images/yellowDot.png">
              <% else %>
                <!-- Ska vara möjligt att ändra tilldelad sektion i detta läge -->
                <img src="/images/greenDot.png">
              <% end %>
            <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<% end %>
